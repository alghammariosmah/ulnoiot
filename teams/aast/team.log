# Team log of team Chris, Flo, Gerald and Sam [Teamname = aast]

##Devices[ulno]
1 x Olimex Development Board
1 x Pi Zero W (returned)
3 x wemosd1mini
1 x devkit1_2led3but
1 x NFC board
1 x Temperature sensor

##Devices[university]
1x Empty board
1x Pi Viiros board
1x Flat cable
1x Pi box

##Who is who

###Florian Schrofner
who are you? why studying mobile computing?
florian, from salzburg, did my bachelors here
started mobile computing as world is becoming more mobile and its becoming more and more important topic
(chose to do masters as it offers a lot of additional hands-on experience and a open curriculum)

what do you expect from h&b?
a lot of tinkering with the raspberry
cool setups that you can try at home
new linux skills

if you were a team of 4 persons what would you bring to the table?
experienced linux user, using linux since i started my bachelors
not too much experience with sensors

###Christian Altenhofer
####Who are you, why are you studying Mobile Computing?

	*Chris, Bachelors Degree in Mobile Computing in Hagenberg.
	*I started the master because i think mobile stuff is the 
	future and i like working on mobile devices.

####What do you expect from H&B Automation?

	*I expect some hands-on on some hardware and technologies we need in our homes and future homes.
	*Maybe some stuff we can use at home as well.

####Strength and weaknesses!

	*i currently work as part time android dev. im good at programming and working 
	in a team, using version control systems.
	*not so good at dokumentation
	*not good at linux

###Gerald Teufl
####Who are you, why are you studying Mobile Computing?
Gerald from lower austria, also did the Bachelor in Mobile Computing, like the smaller systems
which are a mixture of hardware and software, using harware with sensors and develop server software, apps
and the communication between them.

####What do you expect from H&B Automation?
I already have experience with hardware devices and some IoT devices but not in the H&B area. I expect
that I can extend my skills in this area.

####Strength and weaknesses?
My strength are that I have experience with linux, hardware and networks and I like it to work in a team. I
also have no problems with documentation. A weakness and strength at the same time is that I am a 
perfectionist. Moreover, I have basic experience with git but not that much with advanced git functions.  

###Osamah Al-Ghammari
####who are you? why studying ENI?
I am Osamah Al-Ghammari, called me Sam, A computer engireering bachelor graduate and ENI master student. 

####what do you expect from h&b? 
Learning new hardware and some software skills.

####Strength and weaknesses?
good at SSH, Linux, network and security, and Python, C and Java programming langauges. 
Spending so much time programming a task.


## Watching two movies and answer questions
	* What might be doable?
	* What not?
	* When?
	* Weirdness/crazyness?

### Movie 1
        * Lamp -> doable
        * Stereo, Music Player -> doable
        * Public access -> doable
        * Public access for all things -> not doable in this way they showed
        * Security/Privacy -> weird, crazy

#### Technologies
Wireless access, networks

### Movie 2
        * Displays -> AR, VR, just one guy monitors everything
        * Holograms -> not in the near future
        * Rooms moving -> doable but quiet far away
        * Doorless doors -> what if somebody is not allowed to enter?
        * Navigation -> doable
        * Modularity -> doable
        * Intelligent networking -> doable
        * Energy management -> near future
        * Lightning reacts on emergancy, reaction on full escape ways
        * Security -> increase security but also opens new doors for security issues

### Scenarios & application domains
	1. switch on light, turn down stereo, control cars
	2. buildings into living organism, adapting to users, managing water & energy, evacuation scenarios


## Video recording and preperation
	* phrasing the statements
	* prepairing arguments
	* recording video
	* written down on file debate.txt, who did what in bulletlist_debate.txt

## Debate 
### Statement round
	* contra. price, costs -> not everyone has the ability to install home automation, after years some parts break replace?
		- every tech if smart or dump, needs support. if you gear your house with eg. thermostats, why not use a smart thermostat?
	* contra. non tech affine persons cant use smart home systems
		- i think it's in the hand of the companies to design the
	* pro. every person can use home automation, the stuff is made to be used in a simple way.
	* contra. privacy, information in the internet.
		- google, you use a notebook (google.com), and use your smartphone anyways. why not use the smartphone in your network.
	* contra. economicy, big companies instead of small family buisnesses(butchery, farmers)
	* contra. security, unsave OS are used, functionality over security.
	* pro. efficiency, remotly, find energy hogs
	* pro. security, safty against natrual forces, or thievs(motion detect, thermal cams)
	* pro. productivity, provides a better working enviroment, better usage of space(shared spaces, costs)
	#### 1st. Topic Safety, Security and Privacy
	* systems may be not secure? every OS is unsecure in a way, linux for example is unsecure in a way as well.
	* private informations? privacy against convinience.
	* hardware key is not hackable! fingerprints are reproduceable.
		- you can lose your hardware key ofter equipped with tags!
	#### 2st. Topic Efficiency, Costs
	* smart theromostats, reduce the heating costs. smart shading reduce heating -> 20-30%
	* you have maintenance costs.
		- when heating/cooling is running all the time you have inefficient usage. 
		- maintenance costs are with dump devices as well. 
		so when you need a new system, why not install a smart device.
	#### 3st. Big Players, combine differnet systems, interoperability.
	* one system rules them all, give all informations to this company(amazon eco)
		- small companies like loxone keep your data private(server is in home)
	* differencial privacy (anynomise big data)

	* Cons
        * cost effiency -> hire company -> not everyone has the ability to build a system, 40 years that it will get profitable
        * makes life much more complicated
        * google knows the answer of people when using smartphones -> using for home automation
        * they are creating profiles of everyone
        * economics -> kills small scale industries -> supermarkets
        * security -> no one cares about that
        * not so complex to raise false alarms
        * save 100€ per year -> not much -> tooks 10 years but costs maintainance

	*Pros
        * also not technical persons can use home and bulding automation systems
        * safety -> able to control and sense everything -> emergency
        * connect to your neighborhood
        * time savings
        * energy savings -> reduce energy wastage
        * save money -> smart shading -> 20% - 30% saving of energy
        * usage -> monitoring


## Raspberry Pi setup
        1. Flash micro sd card with ulnoiot
        2. Connect to wifi access point of Raspberry Pi 3 (iotempire-b78ea5)
        3. Connect Raspberry Pi also via LAN to get internet access
        4. Connect via ssh to the raspberry pi 3, password: internetofthings
        5. Change password authentication to public/private key authentication
        6. Create key pair and copy public key to authorized keys on raspberry pi 3
        7. change wifi access point name for example to "teuschro" with password "schroteu"

## wemosd1mini setup
        1. Type "ulnoiot" command to get into the environment
        2. wemosd1mini can then be flashed with the command "flash_wemosd1mini"
        3. Next step is to deploy with the command "deploy_wemosd1mini" (2 times probably)

type "console" -> serial connection
"help" -> help documentation

## Blue led
        * init led -> "onboardled.init(Pin.OUT)"
        * toggle led (on, off) -> "onboardled.on()" and "onboardled.off()"

## Connect wemosd1mini with wifi
        1. wscan -> scan wifi networks
        2. wifi("teuschro", "schroteu") -> for connecting to the access point
        3. wip -> shows wireless ip -> 192.168.12.18

        * pull git repo for new firmware on Raspberry Pi 3
        * download_firmware -> download newest firmware
        * fix_bin -> binary fixes
        * flash_esp8266 -> flashing
        * again deploying

Micropython webrepl was not working with Firefox on Linux and Windows but
it worked on Microsoft's Edge browser on Windows.

## Public/Subscriber mqtt
        1. reset()
        2. mqtt("192.168.12.1", "test")
        3. help("shield")
        4. import devkit1_2led3but (depends in which folder we are currently)
        5. devices -> show devices
        6. run() -> to start

## Start using smartlock
        1. Connect relay to the wemosd1mini and the smartlock
        2. Console to connect to wemosd1mini
        3. reset()
        4. Start mqtt with mqtt("192.168.12.1", "lock")
        5. Then import "relay" with import ulnoiot.shield.relay (depends in which folder you are currently)
        6. Check available devices with "devices" command
        7. run() -> run driver
        8. Test program with mqtt_send lock/relay/set on and off on Raspberry Pi 3

## Raspberry Pi 3 NFC setup
        1. Connect the NFC board to the Raspberry Pi 3 using a empty board, NFC board, Pi Viiros board and a flat cable
        2. Image teams/aast/teufl/images/nfc_viiros_boards_connection.png shows the construction
        3. Connect the flat cable to the Pi Viiros board and the Raspberry Pi 3 connectors
        4. Image teams/aast/teufl/images/nfc_raspberrypi3_finish.png shows the finished construction
        5. Install NFC driver like described on https://goo.gl/sE23Vo

## Setting up python scripts to lock/unlock door lock with NFC
### Python NFC script
        1. Install python mqtt library with cmmand "pip install paho-mqtt" on Raspberry Pi 3
        2. Copy python script read.py from home/pi/ulnoiot/pi.nfc/MFRC522-python and rename it to nfc-lock.py
        3. Import mqtt library (import paho.mqtt.client as mqtt)
        4. Add code to the file to connect to the mqtt server and publish the command to unlock the door lock
        5. The added lines are "client = mqtt.Client()", "client.connect("192.168.12.1")" and "client.publish("lock/relay/set", "on")"

On the wemosd1mini subscribe on the mqtt server, import the driver and start running it.

### Python broker script
Then second script is a python brocker script which subscribes in the nfc-id topic and listens for ids. When ids
arrive they will be checked if they are valid ones. If they are valid the door lock will be unlocked and then automatically
locked again after 5 seconds.

```python
        import paho.mqtt.client as mqtt
        from threading import Timer

        authorized_keys = ["b'102-247-124-65'"]

        def on_connect(client, userdata, flags, rc):
                print("Connected with result code "+str(rc))
                client.subscribe("nfc-id")

        def lock():
                client.publish("lock/relay/set", "off")

        def unlock():
                client.publish("lock/relay/set", "on")

        def on_message(client, userdata, msg):
                print("checking if key: " + str(authorized_keys))
                print("received key: " + str(msg.payload))
                if str(msg.payload) in authorized_keys:
                        print("valid key detected")
                        unlock()
                        timer = Timer(5.0, lock)
                        timer.start()


        client = mqtt.Client()
        client.on_connect = on_connect
        client.on_message = on_message

        client.connect("192.168.12.1")

        client.loop_forever()
```

### wemosd1mini start script
Create a user.py script with the follwoing lines of code:
```
from ulnoiot import *
import ulnoiot.shield.relay

mqtt("192.168.12.1", "lock")
run()
```

## Serial connection from the laptop or pc
Therfore, the program minicom or picocom can be used with the command for example "picocom -b 115200 -l -r /dev/ttyUSB0".

## Temperature sensor
        1. Connect temperature sensor shield to wemosd1mini
        2. Download new firmware because there was a bug in the script
        3. Then flash and deploy wemosd1mini using the same steps as written in log on Friday 9. June
        4. Import driver with "import ulnoiot.shield.devkit1_ht"
        5. Temperature and humidity can be read out with the commands "devices["ht1"].temperature()" and "devices["ht1"].humidity()"
        6. Subscribe mqtt with command "mqtt("192.168.12.1", "temp")" and run it with "run()"
        7. The temperature and humidity will the automatically published to "temp/ht1/temperature" and "temp/ht1/temperature"

## Display sensor
	1. Connect display shield to wemosd1mini
	2. Import driver with "import ulnoiot.shield.devkit1_display"
	3. Displays the current ip and the ulnoiot path

## Your friends home

### Counting
- Windows count as one even if there are multiple glass panels
- Floor 1
* Doors: Outside 2, Inside 4 normal, 3 sliding
* Windows: 13 window panels // study room = 2 windows (corner)

- Floor 2
* Doors: Outside 0, Inside 9 normal, 1 sliding
* Windows: 17 window panels // bed 1= 3 windows (2 corners)